# 微内核
|       |                                                     |
| ----- | --------------------------------------------------- |
| 微内核定义 | - 只把核心功能放入内核，其余功能用用户进程的形式运行在用户态                     |
| 微内核优点 | - 内核足够小<br>- 基于C/S模式<br>- 应用机制与策略分离原理<br>- 采用面向对象技术 |
| 微内核缺点 | - 执行效率不高  <br>    开销较大                              |
# 操作系统的引导，即开机过程
![Pasted image 20240704185221](https://github.com/user-attachments/assets/0cdae7e7-7e5e-4cdc-a3f1-5ec0091e4837)
==A、启动过程==
1. CPU加电，CS：IP指向FFFF0H
2. 执行JMP指令跳转到BIOS
3. 登记BIOS中断例程入口地址
4. 硬件自检
5. 进行操作系统引导
==B、引导过程==
step1：CPU从一个特定主存地址开始，取指令，执行ROM中的引导装入程序【即前面的启动过程】
step2：将磁盘的第一块----主引导记录读入内存，执行磁盘引导程序，扫描分区表
step3：从活动分区【又称主分区，即安装了操作系统的分区】读入分区引导记录，执行其中的程序
step4：从根目录下找到完整的操作系统初始化程序【即启动管理器】并执行，完成开机的一系列操作

==C、计算机加电启动过程中执行程序的过程==
自检程序---->引导装入程序/自举装入程序------>引导程序------>操作系统

==D、注意点==

|               |                          |             |
| ------------- | ------------------------ | ----------- |
| 引导装入程序/自举装入程序 | 是位于ROM中的自举程序（BIOS的组成部分）  | 用于启动具体的设备   |
| 引导程序/启动管理器    | 是位于装有操作系统硬盘的活动分区的引导扇区的程序 | 用于引导操作系统    |
| 1、操作系统被装入RAM中 | 2、自举程序BIOS装在ROM中         | 3、引导程序装在硬盘中 |
# 常考的三种操作系统对比
|        |                                            |
| ------ | ------------------------------------------ |
| 批操作系统  | 脱机使用计算机；作业是批处理的；系统内多道程序并发执行；交互能力差；         |
| 分时操作系统 | 多个用户同时使用计算机；人机交互强；具有每个用户独立使用计算机的独占性；系统响应及时 |
| 实时操作系统 | 能对控制对象做出及时反应；可靠性高；响应及时；但资源利用率低             |
# 常见的特权指令和非特权指令
|       |                                                    |                                                                                   |
| ----- | -------------------------------------------------- | --------------------------------------------------------------------------------- |
| 特权指令  | 指不允许用户直接使用的指令                                      | - 对I/O设备操作指令<br>- 存取特殊寄存器的指令<br>- 有关访问程序状态的指令<br>- 置中断指令; 关中断指令<br>- 清内存指令; 置时钟指令 |
| 非特权指令 | 允许用户直接使用的指令  <br>不能直接访问系统中的软硬件资源  <br>只限于访问用户的地址空间 | - 访管/trap指令                                                                       |
# 常见的在管态和在目态运行的程序
|         |                                                                                                                                                            |
| ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 核心态【管态】 | 在核心态运行的指令和程序：<br><br>- 时钟管理相关的指令【置时钟指令】<br>- 中断机制相关的指令【时钟中断程序】<br>- 原语相关的指令<br>- 系统控制的数据结构与处理【进程调度程序】【进程切换】【缺页处理程序】【系统调用命令】                                |
| 用户态【目态】 | 在用户态运行的指令和程序/发生的事件：<br><br>- 命令解释程序【属于命令接口，面向用户】<br>- 访管/Trap指令，跳转指令，压栈指令<br>- 广义指令(系统调用)的调用（系统调用的调用发生在目态，系统调用程序发生在管态）<br>- 外部中断，缺页（缺页现象发生在目态，缺页处理程序发生在管态） |
# 操作系统的概念
- 操作系统负责管理协调硬件，软件等计算机资源的工作
- 操作系统为上层用户，应用程序提供简单易用的服务
- 操作系统是一种系统软件
# 操作系统的特征
- 并发和共享最基本的两个性质
- 并发和共享互为存在条件，没有并发和共享，就谈不上虚拟和异步
## 并发
- 并发concurrent：两个或多个事件在同一时间间隔内发送【同一时间间隔】
- 并行parallel：系统具有同时进行运算或操作的特性【同一时刻】
	- 可并行的有【处理机与设备】【处理机与通道】【设备与设备】
	- 不可并行的有【进程与进程】
	- 真正实现并行的是多核处理机
## 共享
- 共享是指系统中的资源可供内存中多个并发执行的程序共同使用

| 互斥共享方式 | • A用完之后，才可以给B用   |
|--------|------------------|
|        | • 如对摄像头设备的共享使用   |
| 同时共享方式 | • 一段时间内由多个进程同时访问 |
|        | • 如对硬盘资源的共享使用    |
## 虚拟
虚拟是指把一个物理上的实体变为若干逻辑上的对应物

| 空分复用技术【虚拟的扩充空间】 | • 如虚拟存储器    |
|-----------------|-------------|
| 时分复用技术【虚拟的扩充时间】 | • 如处理器的分时共享 |
## 异步
- 进程的执行不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进
# 操作系统的功能和目标
## 资源的管理者
- 处理器管理【第二章：进程与线程】
	- 处理机的分配和运行都以进程为基本单位，处理器管理=对进程的管理
	- 主要功能：进程控制+进程同步+进程通信+死锁处理+处理机调度
- 存储器管理【第三章：内存管理】
	- 为了给多道程序的运行提供良好的环境，方便用户使用及提高内存的利用率
	- 主要功能：内存分配与回收+地址映射+内存保护+共享和内存扩充
- 文件管理【第四章：文件管理】
	- 计算机的信息都是以文件的形式存在的
	- 主要功能：文件存储空间的管理+目录管理+文件读写管理和保护
- 设备管理【第五章：IO管理】
	- 主要是完成用户的I/O请求，方便用户使用各种设备，提高设备的利用率
	- 主要功能：缓冲管理+设备分配+设备处理+虚拟设备
## 为用户和计算机硬件系统提供接口
- 给用户使用的
	- GUI用户图像界面
	- 命令接口

|   |   |
|---|---|
|联机命令接口|【用户发送一个命令，系统就执行一次，主要特点是交互性，适用于分时或实时系统】|
|脱机命令接口|【用户一次性发送命令清单，系统按清单执行，中途不能干预，适用于批处理系统】  <br>【解决独占问题】|
- 给软件/程序员使用的
	- 程序接口【即系统调用】
## 对计算机资源的扩充
- 裸机：没有任何软件支持的计算机
- 扩充机器/虚拟机：覆盖了软件的机器
# 操作系统结构
- 微内核OS知识点补充
	- 优点：【内核足够小】【基于C/S模式】【应用机制与策略分离原理】【采用面向对象技术】
	- 缺点：【性能问题】【开销偏大】
 ![Pasted image 20240704191810](https://github.com/user-attachments/assets/85e1f4a6-fb43-49e8-a28d-4df61f6b44a8)
# 虚拟机
## 定义
使用虚拟化技术，将一台物理机器虚化为多台虚拟机器VM，每个虚拟机器都可独立运行一个操作系统
## 分类
![Pasted image 20240704204016](https://github.com/user-attachments/assets/aee129c6-68c1-48f5-a2ee-fecb6182385b)
# 操作系统的发展历程
## 常考的三种操作系统对比
|        |                                            |
| ------ | ------------------------------------------ |
| 批操作系统  | 脱机使用计算机；作业是批处理的；系统内多道程序并发执行；交互能力差；         |
| 分时操作系统 | 多个用户同时使用计算机；人机交互强；具有每个用户独立使用计算机的独占性；系统响应及时 |
| 实时操作系统 | 能对控制对象做出及时反应；可靠性高；响应及时；但资源利用率低             |
## 其他操作系统对比
- Unix系统是多用户，多任务操作系统，属于分时操作系统
- 多任务系统的特点：【具有并发和并行的特点】【需要实现对共享资源的保护】【需要运行在多CPU的硬件平台上】

|         |                                                                                                  |                                                                                                           |                                                 |                                                      |
| ------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------- | ----------------------------------------------- | ---------------------------------------------------- |
|         | 定义                                                                                               | 特点                                                                                                        | 优点                                              | 缺点                                                   |
| 手工操作阶段  |                                                                                                  |                                                                                                           |                                                 | - 用户独占全机，资源利用率低<br>- CPU等待手工操作，CPU的利用不充分             |
| 单道批处理系统 | - 程序封闭性：程序执行的结果只取决于进程本身，不受外界影响<br>- 失去封闭性后，不同速度下的进程执行结果不同                                        | - 自动性，顺序性，单道性                                                                                             |                                                 | - 资源利用率低，吞吐量小                                        |
| 多道批处理系统 | - 批处理：允许多个用户将若干个作业提交给计算机系统集中处理<br>- 多道性是为了提高系统利用率和吞吐量而提出的                                        | - 多道，共享性，宏观上并行，微观上串行<br>- 引入多道后，系统就失去了封闭性和顺序性<br>- 制约性，程序执行因为共享资源和协同所以产生了竞争，相互制约<br>- 考虑到竞争的公平性，程序的执行是断续的 | - 资源利用率高<br>- 系统吞吐量大<br>- CPU利用率高<br>- IO设备利用率高 | - 用户响应时间长<br><br>- 不提供人机交互能力<br>- 批处理作业时用户无法干预【主要缺点】 |
| 分时操作系统  | - 允许多个用户以交互的方式使用计算机的操作系统<br>- 要求快速响应用户是导致分时系统出现的重要原因<br>- 响应时间 = 时间片*用户<br>- 进程调度通常采用抢占式的优先级高者优先 | - 同时性<br>- 交互性<br>- 独立性<br>- 及时性                                                                          | - 提供人机交互能力                                      | - 不能再规定的时间内做出处理                                      |
| 实时操作系统  | - 在该操作系统下，计算机系统能及时处理由过程控制反馈的数据，并及时做出响应                                                           | - 硬实时系统：必须在绝对严格的时间内完成处理【如导弹控制系统】<br>- 软实时系统：能偶尔接受违反时间规定【如12306火车订票系统】                                     | - 追求的目标：【安全可靠】【及时处理】【快速处理】                      |                                                      |
| 分布式操作系统 |                                                                                                  | - 分布性，并行性                                                                                                 |                                                 |                                                      |
| 网络操作系统  |                                                                                                  | - 网络中各种资源的关系及各台计算机之间的通信                                                                                   |                                                 |                                                      |
## 操作系统运行的环境
### 处理器运行的机制
#### 变态
| 内核态-- >用户态 | 发生在中断返回用户程序时，需要一条修改PSW(程序状态字)的特权命令 |
|------------|------------------------------------|
| 用户态-->内核态  | 发生在中断时，通过硬件完成                      |
#### 为什么要区别核心态和用户态？
为了保护系统程序
## 内核的功能
- 时钟管理：实现计时功能
- 中断处理：负责实现中断机制
- 设备管理：完成设备的请求和释放，以及设备启动等功能
- 文件管理：完成文件的读，写，创建和删除等功能
- 进程管理：完成进程的创建，撤销，阻塞及唤醒等功能
- 进程通信：完成进程之间的信息传递或信号传递等功能
- 内存管理：完成内存的分配，回收以及获取作业占用内存区大小及地址等功
## 原语
- 是一种特殊的程序
- 处于操作系统最底层，是最接近硬件的部分
- 该程序运行具有原子性（运行只能一气呵成，不可中断）
- 运行时间较短，调用频繁
## 系统调用【又叫做广义指令】
### 定义
- 操作系统对应用程序和程序员提供的接口
- 系统调用需要触发Trap【也叫陷入/访管指令】
- os通过提供系统调用避免用户程序直接访问外设【应用程序通过系统调用使用OS的设备管理服务】
- `scanf` 是一个用于从标准输入（通常是键盘）读取数据的 C 库函数。当程序调用 `scanf` 时，CPU 会从用户态转换到核心态。
### 目的
请求系统服务
### 与库函数的区别
| 库函数                       | 系统调用                              |
| ------------------------- | --------------------------------- |
| • 是语言或应用程序的一部分，可以运行在用户空间中 | • 是操作系统的一部分，是内核为用户提供的程序接口，运行在内核空间 |
| • 许多库函数都会使用系统调用来实现功能      | • 未使用系统调用的库函数，执行效率通常比系统调用的高       |
| • 有的库函数没有使用系统调用<br>       | 【因为系统调用要完成上下文的切换和状态的转换】           |
### 按功能分类
- 设备管理：完成设备的请求或释放+设备启动
- 文件管理：完成文件的读+写+创建+删除
- 进程控制：完成进程的创建+撤销+阻塞+唤醒
- 进程通信：完成进程之间的信息传递或信号传递
- 内存管理：完成内存的分配+回收+获取作业占用内存区大小及始址
## 系统调用的过程
![1720097619222](https://github.com/user-attachments/assets/061d97ec-7e7e-428f-a7c9-dc1a8fc84506)

step1：传参

step2：陷入指令/Trap/访管【调用系统调用】发生在用户态  

step3：由操作系统内核程序处理系统调用请求【执行系统调用请求】发生在内核态 

step4：返回应用程序
## 系统调用和一般过程调用的差别
|           |                                                                                           |
| --------- | ----------------------------------------------------------------------------------------- |
| 1.运行状态不同  | - 一般过程调用的调用过程和被调用过程运行在同一系统状态【用户态或内核态】<br>- 系统调用的调用过程是运行在用户态，被调用过程是运行在内核态                  |
| 2.软中断进入机制 | - 一般的过程调用可直接由调用过程转向被调用过程<br>- 系统调用不允许由调用过程直接转向被调用过程，一般通过软中断机制，先进入操作系统内核，经内核分析后才转向相应命令处理程序 |
| 3.返回及重新调度 | - 一般过程调用被调用结束后，返回调用点继续执行<br>- 系统调用被调用完后，要对系统中所有运行进程重新调度<br>- 只有当调用进程仍具有最高优先权才返回调用过程继续执行   |
