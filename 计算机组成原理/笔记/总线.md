# 总线概述
## 为什么要设计总线
I/O设备的种类和数量越来越多，为了解决I/O设备与主机之间连接的灵活性，设计了总线
## 总线的定义
一组能为多个部件分时共享的公共信息传送路线
## 总线的特点
**分时性**：同一时刻只允许有一个部件向总线发送信息；同一时刻只能有一个主设备控制总线的传输操作

**共享性**：总线上可以挂接多个部件
## 总线优缺点
| 优点 | • 便于增减外设              |
|----|-----------------------|
|    | • 减少信息传输线的条数          |
| 缺点 | • 降低了信息传输的并行性和信息的传输速度 |
## 总线设备
按其对总线有无控制能力可分为主设备和从设备
- 主设备：获得总线控制权的设备
- 从设备：被主设备访问的设备，它只能响应从主设备发来的各种总线命令
## 总线特性
机械特性：尺寸，大小

电气特性：传输方向和有效电平范围

功能特性：每根传输线的功能

时间特性：信号和时序的关系
## 总线分类
### 按功能划分
#### 片内总线
- 芯片内部的总线
- 是CPU芯片内部寄存器与寄存器之间、寄存器与ALU之间的公共连接线
#### 系统总线
- 计算机系统内各功能部件（CPU、主存、I/O接口）之间相互连接的总线
- 按系统总线传输内容的不同又可分为3类

|      |                                                              |
| ---- | ------------------------------------------------------------ |
| 数据总线 | - 传输各功能部件之间的数据信息<br>- **是双向传输线**，其位数与机器字长、存储字长有关。            |
| 地址总线 | - 指出主存和I/O设备接口电路的地址<br>- 是**单向传输线**<br>- 地址总线的位数与主存地址空间的大小有关 |
| 控制总线 | - 传输控制信息<br>- 包括控制命令和反馈信号                                    |
#### I/O总线
- 主要用于连接中低速的I/O设备
- 通过I/O接口与系统总线相连接
- 目的是将低速设备和高速总线分离，以提升总线的系统性能
- 常见的有USB、PCI总线。
#### 通信总线
- 是在计算机系统之间或计算机系统或其他系统之间传送信息的总线
- 通信总线也称外部总线
### 按时序传输方式
同步总线
异步总线
### 按数据传输方式
串行传输：数据的传输在一条线路上按位进行  
并行传输：每个数据位有一条单独的传输线，所有的数据位同时进行  
总线复用方式：不同信号在同一条信号线上分时传输
# 系统的总线结构

|     | 单总线结构                                       | 双总线结构                                     | 三总线结构                                         |
| --- | ------------------------------------------- | ----------------------------------------- | --------------------------------------------- |
| 优点  | - 结构简单，成本低<br>- 易于接入新的设备                    | - 将低速I/O设备从单总线上分离出来<br>- 实现了存储器总线和I/O总线分离 | - 提高了I/O设备的性能<br>- 使其更快地响应命令<br><br>- 提高系统吞吐量 |
| 缺点  | - 带宽低，负载重<br>- 多个部件只能争用唯一的主线<br>- 不支持并发传送操作 | - 需要增加通道等硬件设备                             | - 系统工作效率低                                     |
| 组成  | 系统总线                                        | 主存总线+I/O总线                                | I/O总线+主存总线+DMA总线                              |
| 结构图 | ![Pasted image 20240630144121](https://github.com/user-attachments/assets/e8f5b554-5e02-4631-a923-3c81cfa193ad)      |   ![Pasted image 20240630144125](https://github.com/user-attachments/assets/1a83bb5b-22a5-4b9d-a773-115ec47ad7ec)  | ![Pasted image 20240630144130](https://github.com/user-attachments/assets/2f8b744f-eb22-408b-ada1-7f01c2e2d390)  |
## 总线的性能标准
|            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 总线传输周期     | - 指一次总线操作所需的时间，由若干总线时钟周期构成                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 总线时钟周期     | - 即机器的时钟周期                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 总线工作频率     | - 总线上各种操作的频率，为总线周期的倒数 工作频率=1/总线周期 |
| 总线时钟频率     | -         1/时钟周期|
| 总线宽度（总线位宽） | - 总线上同时能传输的数据位数，通常指数据总线的根数                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 总线带宽       | - 总线的最大数据传输率，即单位时间内总线上最多可传输数据的位数<br>- 总线带宽=总线工作频率×（总线位宽/8）【单位为 字节/s】                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 总线复用       | - 一种信号线在不同的时间传输不同的信息<br>- 因此可以使用较少的线传输更多的信息，从而节约空间和成本                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 信号线数       | - 地址总线、数据总线和控制总线3种总线数的总和称为信号线数                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|            | - 其中最重要的是总线宽度、总线工作频率、总线带宽<br>- 三者关系：（总线带宽）或者说（传输率）=总线宽度×总线工作频率                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
# 总线事务和定时
- 总线事务：从请求总线到完成总线使用的操作序列。【在一个总线周期中发生的一系列活动】
## 总线事务的过程
| 请求阶段 | 主设备发出总线传输请求并且获得总线控制权                      |
|------|-------------------------------------------|
| 仲裁阶段 | 总线仲裁机构决定将下一个传输周期的总线使用权授予某个申请者             |
| 寻址阶段 | 主设备通过总线给出要访问的从设备地址及有关命令，启动从模块             |
| 传输阶段 | 主模块和从模块进行数据交换，可单向或双向进行数据传送（一般只能传输一个字长的数据） |
| 释放阶段 | 主模块的有关信息均从系统总线上撤除，让出总线使用权                 |
## 突发传送总线事务
- 突发传送总线事务是指发送方在传输完成地址后，连续进行若干次数据的发送，即一次传输一个地址和一批连续的数据
- 突发传送方式能够进行连续成组数据的传送；其寻址阶段发送的是连续数据单元的首地址
- 突发传送方式可以提高总线数据传输率
- 主设备只需给出一个首地址，从设备就能从首地址开始的若干连续单元读出或写入多个数据

总线定时/控制：总线在双方交换数据的过程中需要时间上配合关系的控制【实质是一种协议或者规则】

|     |                                                                                                           |                                                                                                                                 |
| --- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
|     | 同步定时/控制方式                                                                                                 | 异步定时/控制方式                                                                                                                       |
| 定义  | - 由统一时序控制的通信方式<br>- 同步通信采用公共时钟，有统一的时钟周期，同步时钟信号不由各设备提供<br>- 同步控制既可以用于CPU控制，又可用于高速的外部设备控制                   | - 没有统一的时钟；没有固定的时间间隔（不采用时钟信号，只采用握手）<br><br>- 完全依靠传送双方相互制约的“握手”信号来实现定时控制<br><br>- 传送操作是由双方按需求分配时间的<br>- 每次握手完成一次通信，但是一次通信往往交换多位数据 |
| 优点  | - 传送速度快，具有较高的传输速率<br>- 总线控制逻辑简单<br><br>- 同步通信不需要应答信息且总线长度短<br>- 同步通信用一个公共的时钟信号进行同步<br>- 同步通信中，各部件的存取时间较接近 | - 总线周期长度可变<br><br>- 能保证两个工作速度相差很大的部件或设备之间可靠地进行信息交换<br>- 自动适应时间的配合                                                               |
| 缺点  | - 主从设备属于强制性同步<br>- 不能及时进行数据通信的有效性验证<br>- 可靠性较差                                                            | - 比同步稍复杂一些，速度比同步方式慢                                                                                                             |
| 适用于 | - 适用于总线长度较短及总线所接部件的存储时间比较接近的系统<br><br>- 采用同步控制也可以进行数据的传输，但不能发挥快速设备的高速性能                                   | - 主要用于在不同的设备间进行通信                                                                                                               |
# 异步定时方式分类
![Pasted image 20240630181327](https://github.com/user-attachments/assets/9491b974-311b-4d5b-bbb6-421ac9796d32)

|       |                                                                                 |
| ----- | ------------------------------------------------------------------------------- |
|       | 本质                                                                              |
| 不互锁方式 | - 主设备发请求---->不必等从设备的回答，才能撤销“请求信号”【速度最快】                                         |
| 半互锁方式 | - 主设备发请求--->需要等从设备的回答，才能撤销“请求信号”  <br>    从设备收到回答--->不必等到主设备的"请求信号"撤销，才撤销“回答信号” |
| 全互锁方式 | - 主设备发请求--->需要等从设备的回答，才能撤销“请求信号”  <br>    从设备收到回答--->需要等到主设备的"请求信号"撤销，才撤销“回答信号” |
