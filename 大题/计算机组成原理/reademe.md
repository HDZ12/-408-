[2011统考真题]
假定在一个8位字长的计算机中运行如下C程序段：
```C++
unsigned int x = 134;
unsigned int y = 264;
int m=x;
int n=y;
unsigned int z1=x-y;
unsigned int z2=x+y;
int k1=m-n;
int k2=m+n;
```
若编译器编译时将8个8位寄存器R1~R8分别分配给变量X,y,m,n,z1,z2,k1和k2.
请回答下列问题（提示：有符号整数用补码表示）。

1.  执行上述程序段后，寄存器R1、R5和R6的内容分别是什么（用十六进制表示）

**考察知识点**：无符号数计算 unsigned int->无符号数,无难度，注意计算

$R1: x=134=2^7+2^2+2=1000  0110=86H$

$y=246=255-9=2^8-1-2^3-1=1111 0110$

$R5: z1= x - y =1000 0110-1111 0110 = 1001 0000=90H$(注意点无符号数减法借位)

$R6:z2= x + y=1000 0110 +1111 0110= 0111 1100=7CH$

2. 执行上述程序段后，变量m和k1的值分别是多少（用十进制表示）？

**考察知识点**： 有符号数计算，无符号数变为有符号数，有符号数在计算机中存储方式为补码

$m= 1000 0110 -> 1111 1001+1=1111 1010=-(127-5)=-122$

$[k1]_补=m-n=[m]_补+[-n]_补= 1000 0110 + 0000 1001 +1=1000 0110 + 0000 1010= 1001 0000$

$k1=1111 0000= -112 $

3. 上述程序段涉及有符号整数加减、无符号整数加减运算，这四种运算能否利用同一个加法器辅助电路实现？简述理由。

答：能，n位加法器实现的是模 $2^n$ 无符号整数加法运算，对于无符号数 a,b a+b直接实现，a-b用a加b的补数实现
 $a-b=a+[-b]_补(mod 2^n)$,带符号整数用补码表示，补码加减运算公式为 $[a]_补+[b]_补(mod 2^n),[a]_补+[-b]_补(mod 2^n)$
 所以都可以实现。

 4. **计算机内部**如何判断有符号整数加减运算的结果是否发生溢出？上述程序段中，哪
些有符号整数运算语句的执行结果会发生溢出？
加法器两各输入端符号相同，且不同于输出端，或次高位与最高位的进位不同，溢出的是k2。

[2012年真题]某`16位`计算机中，有符号整数用`补码`表示，数据Cache和指令Cache
分离。下表给出了指令系统中的部分指令格式，其中Rs和Rd表示寄存器，mcm表示
存储单元地址，(X)表示寄存器X或存储单元X的内容。


![1725068136450](https://github.com/user-attachments/assets/71d6dbda-7d67-470d-9721-ee4337082be3)

该计算机采用5段流水方式执行指令，各流水段分别是取指(F)译码/读寄存器(D)、
执行/计算有效地址(EX)、访问存储器(M)和结果写回寄存器(WB),流水线采用“按
序发射，按序完成”方式，未采用转发技术处理数据相关，且同一寄存器的读和写操作
不能在同一个时钟周期内进行。请回答下列问题：

1. 若int型变量x的值为-513，存放在寄存器R1中，则执行“SHR R1”后，R1中的
内容是多少（用十六进制表示）？

根据表格可知 SHR R1为算数右移，

$-513=-(2^9+1)=1111 1110 0000 0001->1111 1101 1111 1110+1->1111 1101 1111 1111->算数右移->1111 1110 1111 1111->FEFFH$

2. 若在某个时间段中，有连续的4条指今进入流水线，在其执行过程中**未发生任何阻
塞**，则执行这4条指令所需的时钟周期数为多少？

$T=5t+(4-1)*t=8t$

3. 若高级语言程序中某赋值语句为x=a+b,x、a和b均为int型变量，它们的存储单
元地址分别表示为[x]、[a]和[b]。该语句对应的指令序列及其在指令流中的执行过程
如下所示

```c++
I1 LOAD R1,[a]
I2 LOAD R2,[b]
I3 ADD R1,R2
I4 STORE R2,[x]
```

![1725069147046](https://github.com/user-attachments/assets/88b4b75b-76b7-4d77-8878-8143fb0af6ce)

则这4条指令执行过程中I3的ID段和I4的iF段被阻塞的原因各是什么？

I3中的ID段被阻塞的原因是因为I3和I1和I2都存在数据相关，需等到I1和I2把结果谢晖寄存器，I3才能读寄存器中的内容，所以被阻塞，I4中的IF是因为前一条I3在ID被阻塞，所以I4的IF被阻塞，否则，会覆盖指令寄存器，导致I3译码错误。

4. 若高级语言程序中某赋值语句为x=x*2+a,x和a均为unsigned int类型的变量，它
们的存储单元地址分别表示为[x],[a],则执行这条语句至少需要多少个时钟周期？要
求模仿上图画出这条语句对应的指今序列及其在流水线中的执行过程示意图

``` C++
I1 LOAD R1, [x]
I2 LOAD R2, [a]
I3 SHL  R1
I4 ADD  R1,R2
I5 STORE R2, [X]
```


| 时钟 指令 | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  | 16  | 17  |
| ----- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| I1    | IF  | ID  | EX  | M   | WB  |     |     |     |     |     |     |     |     |     |     |     |     |
| I2    |     | IF  | ID  | EX  | M   | WB  |     |     |     |     |     |     |     |     |     |     |     |
| I3    |     |     | IF  |     |     | ID  | EX  | M   | WB  |     |     |     |     |     |     |     |     |
| I4    |     |     |     |     |     | IF  |     |     |     | ID  | EX  | M   | WB  |     |     |     |     |
| I5    |     |     |     |     |     |     |     |     |     | IF  |     |     |     | ID  | EX  | M   | WB  |

[2014真题]某程序中有循环代码段P:“for(inti=0:i<N:i++)sum+=A[i];”。假
设编译时变量sum和i分别分配在寄存器R1和R2中。常量N在寄存器R6中，数组A
的首地址在寄存器R3中。程序段P的起始地址为0804 8100H,对应的汇编代码和机器
代码如下表所示。

| 编 号 | 地址 | 机器代码 | 汇编代码 | 注释 |
| --- | --- | --- | --- | --- |
| 1 | 08048100H | 00022080H | loop: sl R4,R2, 2 | (R2)<<2→R4 |
| 2 | 08048104H | 00083020H | add R4, R4, R3 | (R4)+(R3)→R4 |
| 3 | 08048108H | 8C850000H | load R5,0(R4) | ((R4)+0)→R5 |
| 4 | 0804810CH | 00250820H | add R1, R1, R5 | (R1)+(R5)→R1 |
| 5 | 08048110H | 20420001H | add R2, R2, 1 | (R2)+1->R2 |
| 6 | 08048114H | 1446FFFAH | bne R2,R6, loop | if(R2)!=(R6)goto loop |

执行上述代码的计算机M采用32位定长指令字，其中分支指令bne采用如下格式：

![1725071728302](https://github.com/user-attachments/assets/78db56c3-1455-445d-8e17-4a8c452c6b8c)

OP为操作码；Rs和Rd为寄存器编号：OFFSET为偏移量，用补码表示。请回答下列问题，并说明理由。

1. M的存储器编址单位是什么？
 
字节，一个指令定长32位，执行一个指令消耗四个地址，一个地址消耗八位，一个字节

2. 已知sll指令实现左移功能，数组A中每个元素占多少位？

占4B，因为每次变化左移两个地址，相当于×4,每个元素也就是 4B。

3. 表中bne指令的OFFSET字段的值是多少？已知bne指令采用相对寻址方式，当前
PC内容为bne指令地址，通过分析表中指令地址和bne指今内容，推断bne指令的
转移目标地址计算公式。

由表可知，bne指令的机器代码为1446 FFFAH,根据题目给出的指令格式，后2B的内容
为OFFSET字段，所以该指令的OFFSET字段为FFFAH,用补码表示，值为-6。系统执
行到bne指令时，PC自动加4，PC的内容为08048118H,而跳转的目标是08048100H,
两者相差了18H,即24个单位的地址间隔，所以偏移地址的一位即是真实跳转地址的
-24-6=4位。可知bne指令的转移目标地址计算公式为(PC)+4+OFFSETx4。

4. 若M采用如下“按序发射、按序完成”的5级指令流水线：IF(取值)、ID(译码及
取数)、EXE(执行)、MEM(访存)、WB(写回寄存器)，且硬件不采取任何转发措
施，分支指令的执行均引起3个时钟周期的阻塞，则P中哪些指今的执行会由于数
据相关而发生流水线阻塞？哪条指令的执行会发生控制冒险？为什么指令1的执行
不会因为与指令5的数据相关而发生阻塞？

由于数据相关发声阻塞的指令为2,3,4,6条指令，都与前一条有数据相关，第六条会发生控制冒险，因为第六条指令之后会有三个周期的阻塞，消除了数据相关。

[2010年]某计算机的主存地址空间大小为256MB,按字节编址。指令Cache和
数据Cache分离，均有8个Cache行，每个Cache行大小为64B,数据Cache采用直接
映射方式。现有两个功能相同的程序A和B,其伪代码如下所示：

![1725260693117](https://github.com/user-attachments/assets/a779552c-bb98-4f8a-9e2f-560ac13fcc68)

假定int型数据用32位补码表示，程序编译时，i、j和sum均分配在寄存器中，数组a
按行优先方式存放，其首地址为320（十进制数）。请回答下列问题，要求说明理由或给
出计算过程。

1. 不考虑用于Cache一致性维护和替换算法的控制位，数据Cache的总容量为多少？

主存地址空间256MB= $2^{28}B$ 一共占28位，八个chache行，三位用于映射，行大小64B
六位是行内地址，标志位占 28-3-6=19位，还需使用一个有效位，所以容量为
 $cache=8 \times (64+20/8)B =532B $

2. 数组元素a[0][31]和a[1][1]各自所在的主存块对应的Cache行号是多少(Cache行号
从0开始)？

数组a的首地址为320=256+64=0000140H->倒数九位为 101000000->行地址是5，索命从第五行开始存取，一行64B->一个数据占32位（4B）共能存取16个数字，a[0][31]前面有30个数，它映射到第6行，a[1][1]前面有257个数，258/16=16.25 也就是对5+17-16-1=5。
计算公式：
$[(320+(i\times 256+j) \times 4)div 2^6]mod 2^3$

3. 程序A和B的数据访问命中率各是多少？哪个程序的执行时间更短？

数组A每一行只有第一次不命中，所以命中率为 15/16=93.75%,对于B全不命中，命中率为0.

[2013]某32位计算机，CPU主频为800MHz,Cache命中时的CPI为4，Cache
块大小为32B:主存采用8体交叉存储方式，每个体的存储字长为32位、存储周期为
40ns:存储器总线宽度为32位，总线时钟频率为200MHz,支持突发传送总线事务。每
次读突发传送总线事务的过程包括：传送首地址和命令、存储器准备数据、传送数据。
每次突发传送32B,传送地址或32位数据均需要一个总线时钟周期。请回答下列问题，
要求给出理由或计算过程。

1. CPU和总线的时钟周期各为多少？总线的带宽（即最大数据传输速率）为多少？

$CPU时钟周期=1/f=1/800M=0.125 *10_{-8} =1.25ns,总线时钟周期=CPU时钟周期 *4=5ns$

总线带宽=4B*200MHz=800MB/s

2. chache块大小为32B，因此Cache缺失时需要一个读突发传送总线事务读取一个主存块

3. 存储器总线完成一次读突发传送总线事务所需的时间是多少？
把传送想像成一个流水段，将数据准备到传输完成想象成一个流水段，每段的时间为5ns,一共为：5ns+45ns+7*5ns=85ns.

4. 若程序BP执行过程中共执行了100条指令，平均每条指令需进行1.2次访存，Cache
缺失率为5%，不考虑替换等开销，则BP的CPU执行时间是多少？

 100*5ns+(5 *1.2 * 85)=1010ns

[2011统考真题]某计算机存储器按字节编址，虚拟（逻辑）地址空间大小为16MB,
主存（物理）地址空间大小为lMB,页面大小为4KB;Cache采用直接映射方式，共8
行；主存与Cache之间交换的块大小为32B。系统运行到某一时刻时，页表的部分内容
和Cche的部分内容分别如下的左图和右图所示，图中页框号及标记字段的内容为十六
进制形式。

回答下列问题：

1)虚拟地址共有几位，哪几位表示虚页号？物理地址共有几位，哪几位表示页框号（物
理页号)？

虚拟地址为16MB $2^24B$,虚拟地址一共24位，其中页面大小为4KB $2^12B$,页内偏移占12位，一共有 $16MB/4KB=2^12$位，高12位表示虚页号，物理地址有 $1MB=2^20B$页，物理地址共有20位，页框大小为 $1MB/4KB=2^8$ 高8位表示页框号。

2)使用物理地址访问Cache时，物理地址应划分成娜几个字段？要求说明每个字段的
位数及在物理地址中的位置。

应该划分成三个字段：标志位+chache行号+行内偏移地址。一共有8行，行号占三位，交换一个块的大小为32B，行内偏移量位5位，剩下的位标志位一共20-3-5=12位，高12位为标志位，中间三位为行号，后五为为行内偏移量。

![1725446857300](https://github.com/user-attachments/assets/7bd1fca5-5ec5-47f5-bf78-8f52082e0b2a)

3)虚拟地址001C60H所在的页面是否在主存中？若在主存中，则该虚拟地址对应的物
理地址是什么？访问该地址时是否Cache命中？要求说明理由。

001表示虚页号，虚页号是1，有效位为1，所以在内存中，页框号为04，对应的物理地址为04C60H，后八位为 0110 0000 行号为 011 第三块，有效位为1，标记为105和标记不一致，不命中。

4. 假定为该机配置一个四路组相联的TLB,共可存放8个页表项，若其当前内客（十
六进制)如下图所示，则此时虚拟地址024BACH所在的页面是否存在主存中？要求
说明理由。

由于TLB采用四路组相联，因此TLB被分为8/4=2个组，因此虚页号中高11位为TLB
标记、最低1位为TLB组号。虚拟地址024BACH=000000100100101110101100B,虚
页号为000000100100B,TLB标记为00000010010B(即012H),TLB组号为0B,因
此该虚拟地址所对应的物理页面只能映射到LB的第0组。组0中存在有效位=1、标
记=012H的项，因此访间TLB命中，即虚拟地址024BACH所在的页面在主存中。

